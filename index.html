<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Cloud Storage</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    h2 { color: #333; }
    form { margin-bottom: 20px; }
    progress { width: 100%; height: 24px; }
    .status { margin-top: 10px; }
    .file-list { margin-top: 30px; }
  </style>
</head>
<body>
  <h2>My Cloud Storage</h2>

  <form id="uploadForm" enctype="multipart/form-data">
    <input type="file" name="file" required />
    <button type="submit">Upload</button>
  </form>

  <div id="uploadStatus" style="display:none;">
    <label>Uploading:</label>
    <progress id="uploadProgress" value="0" max="100"></progress>
    <span id="uploadPercent">0%</span>
  </div>

  <div class="file-list">
    <h3>Uploaded Files</h3>
    <ul id="fileList"></ul>
  </div>

  <script>
    function loadFiles() {
      fetch('/files')
        .then(res => res.json())
        .then(files => {
          const list = document.getElementById('fileList');
          list.innerHTML = '';
          files.forEach(file => {
            const li = document.createElement('li');
            li.innerHTML = `<a href="/uploads/${file.filename}" target="_blank">${file.originalname}</a>`;
            list.appendChild(li);
          });
        });
    }

    document.getElementById('uploadForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const formData = new FormData(this);
      const xhr = new XMLHttpRequest();

      document.getElementById('uploadStatus').style.display = 'block';

      xhr.upload.addEventListener('progress', function (e) {
        if (e.lengthComputable) {
          const percent = Math.round((e.loaded / e.total) * 100);
          document.getElementById('uploadProgress').value = percent;
          document.getElementById('uploadPercent').innerText = percent + '%';
        }
      });

      xhr.onload = function () {
        alert(xhr.responseText);
        document.getElementById('uploadForm').reset();
        document.getElementById('uploadStatus').style.display = 'none';
        loadFiles();
      };

      xhr.open('POST', '/upload');
      xhr.send(formData);
    });

    loadFiles();
  </script>
</body>
</html>
